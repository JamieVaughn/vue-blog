<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ad-hoc Polymorphism in Javascript Functions | yield ✴️ star</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/blog/logo.png">
    <meta name="description" content="stuff">
    <meta name="keywords" content="things">
    
    <link rel="preload" href="/blog/assets/css/0.styles.3c96d357.css" as="style"><link rel="preload" href="/blog/assets/js/app.ea551e99.js" as="script"><link rel="preload" href="/blog/assets/js/3.3e8bd561.js" as="script"><link rel="preload" href="/blog/assets/js/22.6650308e.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.ee735fed.js"><link rel="prefetch" href="/blog/assets/js/11.493f7ca4.js"><link rel="prefetch" href="/blog/assets/js/12.00bfbad9.js"><link rel="prefetch" href="/blog/assets/js/13.9aa23031.js"><link rel="prefetch" href="/blog/assets/js/14.eb87e545.js"><link rel="prefetch" href="/blog/assets/js/15.cec2ff67.js"><link rel="prefetch" href="/blog/assets/js/16.b211ce21.js"><link rel="prefetch" href="/blog/assets/js/17.ce08f3c6.js"><link rel="prefetch" href="/blog/assets/js/18.969d81ce.js"><link rel="prefetch" href="/blog/assets/js/19.f3478df0.js"><link rel="prefetch" href="/blog/assets/js/20.1982a9c0.js"><link rel="prefetch" href="/blog/assets/js/21.2afc3247.js"><link rel="prefetch" href="/blog/assets/js/23.0eb786a4.js"><link rel="prefetch" href="/blog/assets/js/24.71cb0686.js"><link rel="prefetch" href="/blog/assets/js/25.72fb6580.js"><link rel="prefetch" href="/blog/assets/js/26.ae717071.js"><link rel="prefetch" href="/blog/assets/js/27.d49cd226.js"><link rel="prefetch" href="/blog/assets/js/28.9979e1e9.js"><link rel="prefetch" href="/blog/assets/js/29.206dbede.js"><link rel="prefetch" href="/blog/assets/js/30.8506debe.js"><link rel="prefetch" href="/blog/assets/js/31.e7d08768.js"><link rel="prefetch" href="/blog/assets/js/32.9ecdac9a.js"><link rel="prefetch" href="/blog/assets/js/33.fe7d0406.js"><link rel="prefetch" href="/blog/assets/js/4.a9f51df5.js"><link rel="prefetch" href="/blog/assets/js/5.53478f95.js"><link rel="prefetch" href="/blog/assets/js/6.c0bdc117.js"><link rel="prefetch" href="/blog/assets/js/7.4f990272.js"><link rel="prefetch" href="/blog/assets/js/8.22f16ff3.js"><link rel="prefetch" href="/blog/assets/js/9.9798b7d6.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.9f78e3e8.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.3c96d357.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><script>
  let status = (window || globalThis).localStorage.getItem('joinedwjv')
  if(status === 'success') dismissJoin()
  function recaptchaCallback(){
    var live = document.querySelector('#time');
    live.value = new Date();
    document.querySelector('[name=redirect_to]').value = (window || globalThis).location.href
    document.querySelector('section form input[type=submit]').removeAttribute('disabled');
  }
  function dismissJoin(e, str){
    if(str === 'success') {
      (window || globalThis).localStorage.setItem('joinedwjv', 'success')
    } else{
      return document.querySelector('#ContactMe').remove()
    }
  }
</script> <header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="yield ✴️ star" class="logo"> <span class="site-name can-hide">yield ✴️ star</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Menu</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">Home</a></li><li class="dropdown-item"><!----> <a href="/blog/posts/" class="nav-link router-link-active">Posts</a></li><li class="dropdown-item"><!----> <a href="/blog/archive/" class="nav-link">Archive</a></li><li class="dropdown-item"><!----> <a href="https://wjv.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jamievaughn/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Menu</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">Home</a></li><li class="dropdown-item"><!----> <a href="/blog/posts/" class="nav-link router-link-active">Posts</a></li><li class="dropdown-item"><!----> <a href="/blog/archive/" class="nav-link">Archive</a></li><li class="dropdown-item"><!----> <a href="https://wjv.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jamievaughn/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <!----> </div> <div class="blog" data-v-0a184ec8><section id="ContactMe" href="#ContactMe" data-v-45f3bbbe data-v-0a184ec8><form id="ajax-contact" method="post" action="https://getsimpleform.com/messages?form_api_token=8d73f78e270ace7eeda7529329d6a348" class="post" data-v-45f3bbbe><input type="hidden" name="redirect_to" id="redirect" value="https://wjv.io/blog" data-v-45f3bbbe> <input type="hidden" name="time" id="time" data-v-45f3bbbe> <h3 data-v-45f3bbbe>Join for updates by email! <span onclick="dismissJoin()" class="dismiss" data-v-45f3bbbe>╳</span></h3> <div id="form-feedback" class="hidden" data-v-45f3bbbe>Submitted successfully! Thank you! I'll be in touch shortly.</div> <input name="name" type="name" id="name" required="required" data-v-45f3bbbe> <label for="name" class="name" data-v-45f3bbbe>Your Name:</label> <input name="email" type="email" id="email" pattern=".+@+.+\.[a-z]{2,5}$" required="required" data-v-45f3bbbe> <label for="email" class="email" data-v-45f3bbbe>Your Email:</label> <div class="controls" data-v-45f3bbbe><div data-sitekey="6Ldh-8kUAAAAAMYG8-BxodEZ4zxcn9uV8H4LKMOd" data-callback="recaptchaCallback" class="g-recaptcha" data-v-45f3bbbe></div> <input type="submit" onsubmit="postMsg" onclick="dismissJoin(event, 'success')" disabled="disabled" data-v-45f3bbbe></div></form> <script src="https://www.google.com/recaptcha/api.js" async="async" defer="defer" data-v-45f3bbbe></script></section> <div class="blog__header" data-v-0a184ec8><p class="publish-date" data-v-0a184ec8><time datetime="2021-01-22T12:00:00.000Z" data-v-0a184ec8>January 22, 2021</time></p> <p data-v-0a184ec8>Time to read: 8 min read</p> <h1 class="blog__title" data-v-0a184ec8>Ad-hoc Polymorphism in Javascript Functions</h1></div> <div class="custom content__default" data-v-0a184ec8><p>Ad-hoc polymorphism is one term used to describe functions that execute different logic depending on the arity, or the number of parameters passed to it. It is also called a variable-arity function. Sometimes it is called function-overloading, mostly by detractors of this pattern. But this is a feature in many languages, especially functional paradigm languages. Languages like Elixir, Scheme and even Python support it.</p> <p>While Javascript does not have this as a first-class capability, I'll demonstrate how to work within Javascript's constraints to create an ad-hoc polymorphic function.</p> <h2 id="example-use-case"><a href="#example-use-case" class="header-anchor">#</a> Example Use Case</h2> <p>Let's imagine we want to implement a function that logs client-side events for us in a few different ways. We want it to be able to log a simple message or a message with a priority rating or log to our server using a service, depending on how many arguments are provided. One option is to define three different functions to accomplish this and call each one separately as the case may necessitate it. While there isn't anything necessarily wrong with that, it does present a non-consistent API surface with which to work with. What if we want to call just one logging function no matter which scenario, and let the function handle which internal logging logic to execute? And furthermore we want to do it in a way that avoids the cyclomatic complexity of <code>if</code>-<code>else</code> statements...</p> <p>We could create such a function by leveraging Javascript's array data structure and map the the number of arguments passed to the function to an array position, which would hold the executable logic appropriate for that arity. The array is accessed by arity (minus one) and invoked and then it is returned. Let's take a look at what such an ad-hoc polymorphic function (we'll call it <code>polyLog</code>) might look like:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// We have some library/service that logs to a server via API call</span>
<span class="token keyword">const</span> serverObj <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">log</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Server<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg <span class="token operator">+</span> <span class="token string">' ...Logged to Server API.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// here is our ad-hoc polymorphic function</span>
<span class="token keyword">function</span> <span class="token function">polyLog</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> priority<span class="token punctuation">,</span> dest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>priority<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>priority<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">[</span>arguments<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// you can call it 3 ways for 3 different results</span>
<span class="token function">polyLog</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">)</span>
<span class="token function">polyLog</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token function">polyLog</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> serverObj<span class="token punctuation">)</span>
</code></pre></div><p>So you can see we've leveraged a Javascript array and the fact that the number of parameters passed to a function is exposed via the <code>arguments</code> keyword within the function body. The appropriate index of the array is accessed with <code>arguments.length - 1</code> so the array evaluates to the associated sub-function. The order of the sub-functions in the array must be carefully chosen to correspond with the arguments they need. That part is up the developer to ensure.</p> <p>Encapsulating all of this logging functionality inside one function not only conveniently reduces the API surface for us, but it just makes more sense since it is all related behavior. It also improves maintainability by keeping the function definitions of all possible logging behavior co-located in one data structure. And during refactors, one fix ought to automatically propogate to all invocations of <code>polyLog</code> within the app.</p> <h2 id="some-refactoring"><a href="#some-refactoring" class="header-anchor">#</a> Some Refactoring</h2> <p>The previous section describes the crux of the idea and accomplishes our goal of ad-hoc polymorphism, but let's see if we can clean up or improve that code at all.</p> <p>The first refactoring opportunity is to use function expressions instead of defining the functions inside the returned array. So lets define our logging functions above our <code>polyLog</code> function like so:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">simpleLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">priorityLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> priority</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>priority<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">serverLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> priority<span class="token punctuation">,</span> dest</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>priority<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre></div><p>You'll notice one other necessary change to the sub-functions: We are passing the parameters through now, since they won't be available from the parent scope anymore.</p> <p>We can also make a small memory optimization by defining our array of functions externally and referencing it in our Polymorphic <code>polyLog</code> function:</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// this external array becomes our function-arity map</span>
<span class="token keyword">const</span> arityMap <span class="token operator">=</span> <span class="token punctuation">[</span>simpleLog<span class="token punctuation">,</span> priorityLog<span class="token punctuation">,</span> serverLog<span class="token punctuation">]</span> 

<span class="token comment">// Now polyLog is a wrapping interface for our function-arity map</span>
<span class="token keyword">const</span> <span class="token function-variable function">polyLog</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> priority<span class="token punctuation">,</span> dest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arityMap<span class="token punctuation">[</span>arguments<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> priority<span class="token punctuation">,</span> dest<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>So now the array of sub-functions is defined once instead of each time <code>polyLog</code> is invoked, which saves on memory. And our function is also mostly just an abstraction layer wrapping our array that serves as our function-arity map.</p> <h3 id="note-on-arrow-functions"><a href="#note-on-arrow-functions" class="header-anchor">#</a> Note On Arrow Functions</h3> <p>It's important to note, this technique doesn't really work with arrow functions as they do not contain a reference to <code>arguments</code> in their function body. However, there is a hacky workaround by using the spread operator, although this should be avoided as the parameters necessarily will lose all or most of their semantic meaning.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arityMap <span class="token operator">=</span> <span class="token punctuation">[</span>simpleLog<span class="token punctuation">,</span> priorityLog<span class="token punctuation">,</span> serverLog<span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token function-variable function">polyLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> arityMap<span class="token punctuation">[</span>args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
<span class="token comment">// Because we spread on args, we don't know what each parameter is called anymore</span>
</code></pre></div><h2 id="more-abstraction"><a href="#more-abstraction" class="header-anchor">#</a> More Abstraction</h2> <p>Now that <code>polyLog</code> has been abstracted in the &quot;Some Refactoring&quot; section, it is starting to look more like a general API surface. But let's try to abstract it further. What if we allow the function-arity array to be passed in as a parameter as well so that we can define one <code>polymorph</code> function that could allow any array of functions be invoked with ad-hoc polymorphism?</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">polymorph</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> arity <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">a</span> <span class="token operator">=&gt;</span> a <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
    <span class="token keyword">return</span> array<span class="token punctuation">[</span>arity <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A trade-off that has to be made here is spreading the <code>args</code> out because for this abstract case, we will not know how many parameters the functions will be needing. And so it suffers from not being able to make use of the <code>arguments</code> keyword as before. Instead we have to filter the args array to reveal how many parameters were actually passed. So I'm not sure if that level of abstraction would be useful... It may be taking it too far. We also lose some semantic naming to have one function name handle all of our ad-hoc polymorphic functions. Perhap, though, the benefit can be found in using it more like a factory function that produces other ad-hoc polymorphic functions each with their own helpful names:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// simpleLog, priorityLog &amp; serverLog are defined as above</span>
<span class="token keyword">const</span> arityMap <span class="token operator">=</span> <span class="token punctuation">[</span>simpleLog<span class="token punctuation">,</span> priorityLog<span class="token punctuation">,</span> serverLog<span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token function-variable function">polyLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> priority<span class="token punctuation">,</span> dest</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">polymorph</span><span class="token punctuation">(</span>arityMap<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> priority<span class="token punctuation">,</span> dest<span class="token punctuation">)</span>
<span class="token comment">// anotherArityMap is not defined, but you can imagine what it might be</span>
<span class="token keyword">const</span> anotherArityMap <span class="token operator">=</span> <span class="token punctuation">[</span>double<span class="token punctuation">,</span> exponentiate<span class="token punctuation">,</span> multiply<span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token function-variable function">polyMath</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> num3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">polymorph</span><span class="token punctuation">(</span>anotherArityMap<span class="token punctuation">,</span> num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> num3<span class="token punctuation">)</span>
</code></pre></div><p>So this extra abstraction might be useful as a sort of ad-hoc polymorphic function factory, but your mileage may vary.</p> <h2 id="error-handling"><a href="#error-handling" class="header-anchor">#</a> Error Handling</h2> <p>So far we've used <code>polyLog</code> under the &quot;Happy Path&quot; scenarios only. So let's think about the &quot;Sad Path&quot; and error handling a bit. Sometimes <code>polyLog</code> might be called with no parameters or maybe even with more than three parameters. Let's add some more structure to the function-arity map array so that it can safely handle such situations:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// The sub-functions are back in an internal array in this example</span>
<span class="token keyword">function</span> <span class="token function">polyLog</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> priority<span class="token punctuation">,</span> dest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> nargs <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error: polyLog was invoked with no arguments'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>priority<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>priority<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error: polyLog was invoked with too many arguments: '</span> <span class="token operator">+</span> nargs<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">[</span>nargs <span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> nargs<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We've changed how we are accessing the array index now to use the value of <code>arguments.length</code> without substracting <code>1</code> because now we've added a new sub-function that will execute when no parameters are passed. We also save a reference to <code>arguments.length</code> in the constant <code>nargs</code> (number of args) since we now access that value twice. Finally, we perform a quick comparison on <code>nargs</code> to catch the scenario where more than 3 parameters are passed. In such a case we pass a value of 4 so that a default function will be invoked for handling such errors. The sub-functions at positions 0 and 4 can be customized to handle those class of errors in the way best suited for your use case.</p> <p>If you absolutely want to remove the harded coded numbers <code>3</code> &amp; <code>4</code>, then there's a change you can make to do so which uses the functions <code>.length</code> property, which references the number of parameters that are in the function definition. So we can define a <code>const len</code> that takes that value and uses that to compare against the number of parameters that were actually passed in <code>nargs</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">polyLog</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> priority<span class="token punctuation">,</span> dest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> nargs <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length
  <span class="token keyword">const</span> len <span class="token operator">=</span> polyLog<span class="token punctuation">.</span>length
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error: polyLog was invoked with no arguments'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>priority<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>priority<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error: polyLog was invoked with too many arguments: '</span> <span class="token operator">+</span> nargs<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">[</span>nargs <span class="token operator">&gt;</span> len <span class="token operator">?</span> len <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> nargs<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="typescript"><a href="#typescript" class="header-anchor">#</a> Typescript</h2> <p>In Typescript we can extend this to get terse type checking as well:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">ServerpolyLog</span> <span class="token punctuation">{</span>
    log<span class="token operator">:</span> <span class="token punctuation">(</span>msg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">polyLog</span> <span class="token punctuation">(</span>
    msg<span class="token operator">:</span> String<span class="token punctuation">,</span> 
    priority<span class="token operator">:</span> Number <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> 
    dest<span class="token operator">:</span> ServerpolyLog <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>priority<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dest<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>priority<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">[</span>arguments<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>I'll leave it to the reader to incorporate the error handling parts into the Tyepscript implementation.</p></div> <div class="page-edit" data-v-0a184ec8><!----> <!----></div> <!----> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.ea551e99.js" defer></script><script src="/blog/assets/js/3.3e8bd561.js" defer></script><script src="/blog/assets/js/22.6650308e.js" defer></script>
  </body>
</html>
