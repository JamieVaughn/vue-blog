<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Javascript&#39;s Immutability Toolkit | yield ✴️ star</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/blog/logo.png">
    <meta name="description" content="A list of methods native to Javascript that conserve immutability of data.">
    <meta name="keywords" content="Immutable, javascript, methods">
    
    <link rel="preload" href="/blog/assets/css/0.styles.fb0c766b.css" as="style"><link rel="preload" href="/blog/assets/js/app.43584b3b.js" as="script"><link rel="preload" href="/blog/assets/js/3.a46554c3.js" as="script"><link rel="preload" href="/blog/assets/js/19.f430e474.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.6fd28325.js"><link rel="prefetch" href="/blog/assets/js/11.983818e8.js"><link rel="prefetch" href="/blog/assets/js/12.53ca0f35.js"><link rel="prefetch" href="/blog/assets/js/13.a811be50.js"><link rel="prefetch" href="/blog/assets/js/14.fea56d03.js"><link rel="prefetch" href="/blog/assets/js/15.531cd409.js"><link rel="prefetch" href="/blog/assets/js/16.b0c59329.js"><link rel="prefetch" href="/blog/assets/js/17.9ac5f70d.js"><link rel="prefetch" href="/blog/assets/js/18.b350a569.js"><link rel="prefetch" href="/blog/assets/js/20.7562c402.js"><link rel="prefetch" href="/blog/assets/js/21.a874a5f8.js"><link rel="prefetch" href="/blog/assets/js/22.2761c012.js"><link rel="prefetch" href="/blog/assets/js/23.32a05625.js"><link rel="prefetch" href="/blog/assets/js/24.23b23529.js"><link rel="prefetch" href="/blog/assets/js/25.5ab8a045.js"><link rel="prefetch" href="/blog/assets/js/4.54f4b005.js"><link rel="prefetch" href="/blog/assets/js/5.f2b20d5b.js"><link rel="prefetch" href="/blog/assets/js/6.3d3e9fc0.js"><link rel="prefetch" href="/blog/assets/js/7.71b60bb8.js"><link rel="prefetch" href="/blog/assets/js/8.faf025f0.js"><link rel="prefetch" href="/blog/assets/js/9.6f857871.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.21b1897d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.fb0c766b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="yield ✴️ star" class="logo"> <span class="site-name can-hide">yield ✴️ star</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Menu</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">Home</a></li><li class="dropdown-item"><!----> <a href="/blog/posts/" class="nav-link router-link-active">Posts</a></li><li class="dropdown-item"><!----> <a href="/blog/archive/" class="nav-link">Archive</a></li><li class="dropdown-item"><!----> <a href="https://wjv.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jamievaughn/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Menu</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">Home</a></li><li class="dropdown-item"><!----> <a href="/blog/posts/" class="nav-link router-link-active">Posts</a></li><li class="dropdown-item"><!----> <a href="/blog/archive/" class="nav-link">Archive</a></li><li class="dropdown-item"><!----> <a href="https://wjv.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jamievaughn/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <!----> </div> <div class="blog" data-v-4035481b><div class="blog__header" data-v-4035481b><p class="publish-date" data-v-4035481b><time datetime="2020-12-21T12:00:00.000Z" data-v-4035481b>December 21, 2020</time></p> <p data-v-4035481b>Time to read: 8 min read</p> <h1 class="blog__title" data-v-4035481b>Javascript's Immutability Toolkit</h1></div> <div class="custom content__default" data-v-4035481b><p>We'll survey the various methods available natively in JS that allow us to manipulate data without mutating it in place.</p> <p>In the functional programming paradigm, avoiding mutation of data or state in your application is an important prinicple that helps us to avoid a certain class of bugs related to side effects and state. Maintaining immutibility during data manipulation can help with:</p> <ul><li>State management</li> <li>Pure Functions</li> <li>Race Conditions</li> <li>Developer Experience (DX)</li></ul> <p>When mutating data in place, there is a strong risk that some other piece of the application is still depending on that data's previous state and may break due to that data mutating. By using immutable methods, you can simply make copies of the application state, applying the changes to that copy, and then pass the new copy to the funciton or method that needs to use it, without worrying about other parts of the application being affected by that change unknowingly.</p> <p>This immutability principle is preferred in the React community when creating internal component state and also when using Redux for managing global state.</p> <p>The only real downside is that it uses more memory... but memory isn't in short supply with today's hardware. And the improvement in the DX, by making state management more easily understandable far outweighs that downside, in my opinion.</p> <h2 id="favor-non-mutating-methods"><a href="#favor-non-mutating-methods" class="header-anchor">#</a> Favor Non-Mutating Methods</h2> <p>Here is a list of JS arrays methods and a few other ways to manipulate data in a non-mutating way:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// prefer .slice over .splice and for general array copying</span>
arr<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// prefer .concat over .push</span>
arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// prefer .map over .forEach</span>
arr<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">...</span>arr<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
Object<span class="token punctuation">.</span>keys<span class="token punctuation">,</span> <span class="token punctuation">.</span>values<span class="token punctuation">.</span> <span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// to manipulate Object as Array then convert back</span>
Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>Check MDN's <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from#" target="_blank" rel="noopener noreferrer">Array methods in the side bar on the left<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for an exhaustive list.</p> <p>Pure functions are a central part of data immutability. Pure functions are the canonical black box that simply inputs something and returns some transformation of that input. Input, Output... no side effects. This also tends to keep the functions simple, which improves DX.
A pure function:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> num <span class="token operator">**</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now, obviously for an application to be useful, it has to execute side effects at some point. The idea behind pure functions and immutability is to isolate those effectful parts of the program into as small a space as possible and ensure that the largest amount of the program abides by the immutability principles.</p> <h2 id="avoid-mutating-methods"><a href="#avoid-mutating-methods" class="header-anchor">#</a> Avoid Mutating Methods</h2> <p>Let's briefly mention some of the common mutating methods in JS that you would be advised to avoid by default. There are, of course, circumstances in which these methods should be used, but they should not be the first choice, in general. Consider only using these methods in the isolated edges of your application into which you are segregating your side effects. They also may be needed as a last resort when immutability is not feasible.</p> <div class="language-js extra-class"><pre class="language-js"><code>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// to adapt this to immutability, use .slice(0).sort() or [...arr].sort()</span>
arr<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Mutating in the sense that it inherits prototype properties which can be overwritten</span>
</code></pre></div><p>One note about <code>forEach()</code>: This is the prefered way in the functional paradigm to implement for loops that execute side effects. But for most cases that need loops, <code>map()</code>, <code>filter()</code> and <code>reduce()</code> are the preferred methods.</p> <h2 id="object-freeze-const"><a href="#object-freeze-const" class="header-anchor">#</a> Object.freeze() &amp; const</h2> <p>To protect variables' mutability, JS now has the <code>const</code> keyword. a variable declared with <code>const</code> will be treated as a constant and it will not be able to be overwritten or re-declared. For imuutability reasons, we will want to prefer using <code>const</code> over using <code>let</code> or <code>var</code>. Of course, there will always be reasons to use <code>let</code> in cases that you must be able to re-declare a variable, and that's fine. And there will even be cases to use <code>var</code> for hoisting reasons, for example, and that is also fine. But in general, default to using <code>const</code> unless you find that you positively need one of the other two.</p> <p>One limitation of the <code>const</code> keyword is that it does not prevent overwritting of values in nested data structures like objects and arrays.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myNum <span class="token operator">=</span> <span class="token number">5</span>
myNum <span class="token operator">=</span> <span class="token number">6</span> <span class="token comment">// Throws TypeError, myNum is protected from mutation</span>
<span class="token keyword">const</span> myNum <span class="token operator">=</span> <span class="token number">6</span> <span class="token comment">// Throws SyntaxError, myNum can't be re-declared/re-initialized</span>

<span class="token keyword">const</span> myObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token operator">:</span> <span class="token number">5</span>
<span class="token punctuation">}</span>
myObj <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token comment">// Throws TypeError, myObj is protected from mutation</span>
myObj<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">6</span> <span class="token comment">// this is permitted, the properties within myObj are not protected</span>
</code></pre></div><p>The way to protect neseted data in an object is to use <code>Object.freeze</code>. And since arrays are also objects, this can be used on arrays as well. Here's an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  nested<span class="token operator">:</span> <span class="token punctuation">{</span>
    num<span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>myObj<span class="token punctuation">)</span>
myObj<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">6</span> <span class="token comment">// JS will silently ignore this, now the internal properties are also protected</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myObj<span class="token punctuation">.</span>num<span class="token punctuation">)</span> <span class="token comment">// 5</span>

<span class="token keyword">const</span> myArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>myArr<span class="token punctuation">)</span>
myArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">9</span> <span class="token comment">// JS will silently ignore this, now the internal values are also protected</span>
</code></pre></div><p>Object.freeze has a serious limitation, though and that is that it only freezes an object shallowly:</p> <div class="language-js extra-class"><pre class="language-js"><code>myObj<span class="token punctuation">.</span>nested<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">9</span> <span class="token comment">// this will mutate that property form 1 to 9</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myObj<span class="token punctuation">.</span>num<span class="token punctuation">)</span> <span class="token comment">// 9</span>
myArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">9</span> <span class="token comment">// this will mutate that property from 3 to 9</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 9</span>
</code></pre></div><p>In other words, it only protects to the first level of nesting. So in order to protect all of an arbitrarily nested object or array, you'll have to use a loop or recursion to reach the inner nested objects and freeze each of those as well. This is referred to as a &quot;deep freeze.&quot; And rather than try to write your own algorithm to do it, you can use a small library such as <a href="https://github.com/substack/deep-freeze" target="_blank" rel="noopener noreferrer">this one<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> which has been tested and used safely for many years. However if you really want to implement a simple deep freeze method yourself, it could look something like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> 
      name<span class="token operator">:</span> <span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span>
      job<span class="token operator">:</span> <span class="token punctuation">{</span> 
        title <span class="token operator">:</span> <span class="token string">&quot;Worker&quot;</span>
        employees<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;Phil&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">&quot;Secretary&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">deepFreeze</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// escape condition... no more nesting is detected</span>
  Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>deepFreeze<span class="token punctuation">)</span> <span class="token comment">// recursively apply deepfreeze</span>
  Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">deepFreeze</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>job<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;CEO&quot;</span> <span class="token comment">// Will silently fail</span>
obj<span class="token punctuation">.</span>job<span class="token punctuation">.</span>employees<span class="token punctuation">.</span>Phil<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;programmer&quot;</span> <span class="token comment">// will silently fail</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>job<span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token comment">// &quot;Worker&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>job<span class="token punctuation">.</span>employees<span class="token punctuation">.</span>Phil<span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token comment">// &quot;secretary&quot;</span>
</code></pre></div><h2 id="the-proposal-for-records-and-tuples"><a href="#the-proposal-for-records-and-tuples" class="header-anchor">#</a> The Proposal for Records and Tuples</h2> <p>In TC39 (A committee overseeing feature additions to JS) there is a <a href="https://github.com/tc39/proposal-record-tuple" target="_blank" rel="noopener noreferrer">proposal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to add two deeply immutable data types to the Javascript language: Records and Tuples. A record would essentially be a deeply immutable object and a tuple would essentially be a deeply immutable array.</p> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token comment">// Record</span>
#<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">// Tuple</span>
</code></pre></div><p>These would be a welcome addition to Javascript in general and to the immutability toolkit in particular. It would remove the need for utility libraries like the deep-freeze library discussed above, and even mostly or entirely remove the need for <code>Object.freeze</code>, because now we would have deeply immutable object natively.</p> <h2 id="cautionary-tale"><a href="#cautionary-tale" class="header-anchor">#</a> Cautionary Tale</h2> <p>I've run across a particularly hard to diagnose bug related to mutability in an application of mine. I was creating an array for a game board using <code>Array(10).fill({id: 0})</code>, with the intention that every space on the game board would have a unique object that I could update with game state. Unfortunately, when the <code>.fill</code> method is passed an object, it creates an array where every element is a reference to that same passed object in memory. So as I updated one space in the game state of the board (i.e. one position of that array), every space was mutated with that data, not just the one space I was targeting. It was a very weird bug that was hard to track at first, especially if you don't know about immutability and objects being passed by reference. So if you plan to try to use objects as independent state, you will want to go to the effort of copying the objects immutably and passing the copies around, and not the references. Thankfully with our immutability toolkit, we can now use our trusty <code>.map()</code> method to help us here:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>  <span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token operator">:</span> index<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment">// this will create unique objects in each position of the array.</span>
</code></pre></div><p>Using <code>.from()</code> is an alternative method to accomplish the same thing, because it accepts a callback function as the second argument to fill the values with. So you can pass a callback that returns an object, and each object will be a unique object in memory.</p> <div class="language-js extra-class"><pre class="language-js"><code>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span>length<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token operator">:</span> index<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment">// the second argument in the callback will be the index</span>
</code></pre></div></div> <div class="page-edit" data-v-4035481b><!----> <!----></div> <!----> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.43584b3b.js" defer></script><script src="/blog/assets/js/3.a46554c3.js" defer></script><script src="/blog/assets/js/19.f430e474.js" defer></script>
  </body>
</html>
